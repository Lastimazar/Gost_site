class ProductCart{constructor(){this.items=[];this.init()}init(){this.loadFromLocalStorage();this.setupEventListeners();this.updateCartDisplay()}loadFromLocalStorage(){const e=localStorage.getItem("techstore_cart");e&&(this.items=JSON.parse(e))}saveToLocalStorage(){localStorage.setItem("techstore_cart",JSON.stringify(this.items))}setupEventListeners(){const e=document.getElementById("cartButton"),t=document.getElementById("cartModal"),i=document.querySelector(".close"),s=document.getElementById("clearCart");e&&t&&e.addEventListener("click",()=>{t.style.display="block";this.renderCartItems()}),i&&i.addEventListener("click",()=>{t.style.display="none"}),s&&s.addEventListener("click",()=>{this.clearCart()}),window.addEventListener("click",e=>{e.target===t&&(t.style.display="none")})}addProduct(e){const t=this.items.find(t=>t.id===e.id);t?t.quantity+=1:this.items.push({...e,quantity:1});this.saveToLocalStorage();this.updateCartDisplay()}removeProduct(e){this.items=this.items.filter(t=>t.id!==e);this.saveToLocalStorage();this.updateCartDisplay();this.renderCartItems()}clearCart(){this.items=[];this.saveToLocalStorage();this.updateCartDisplay();this.renderCartItems()}calculateTotal(){return this.items.reduce((e,t)=>e+t.price*t.quantity,0)}updateCartDisplay(){const e=document.getElementById("cartCount"),t=document.getElementById("cartTotal");e&&(e.textContent=this.items.reduce((e,t)=>e+t.quantity,0)),t&&(t.textContent=this.calculateTotal().toLocaleString("ru-RU"))}renderCartItems(){const e=document.getElementById("cartItems");if(!e)return;e.innerHTML="",0===this.items.length?(e.innerHTML='<p class="empty-cart">Корзина пуста</p>'):(this.items.forEach(t=>{const i=document.createElement("div");i.className="cart-item",i.innerHTML=`<div class="item-image"><img src="${t.image||"images/placeholder.jpg"}" alt="${t.alt||t.name}" onerror="this.src='images/placeholder.jpg'"></div><div class="item-info"><h4>${t.name}</h4><p>${t.price.toLocaleString("ru-RU")} руб. × ${t.quantity}</p><p class="item-total">Итого: ${(t.price*t.quantity).toLocaleString("ru-RU")} руб.</p></div><button class="remove-from-cart" data-product-id="${t.id}" aria-label="Удалить товар">×</button>`;i.querySelector(".remove-from-cart").addEventListener("click",()=>{this.removeProduct(t.id)}),e.appendChild(i)}),this.updateCartDisplay())}}document.addEventListener("DOMContentLoaded",function(){window.productCart=new ProductCart});